# Grafana MCP å·¥å…·ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°
æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨Grafana MCPå·¥å…·è¿›è¡Œè‡ªåŠ¨åŒ–ç›‘æ§åˆ†æï¼ŒåŒ…æ‹¬å·¥å…·è°ƒç”¨æ–¹æ³•ã€å‚æ•°é…ç½®å’Œå®é™…åº”ç”¨åœºæ™¯ã€‚

## å¯ç”¨çš„MCPå·¥å…·

### 1. grafana/list_datasources
åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„æ•°æ®æº

#### åŠŸèƒ½æè¿°
- è·å–Grafanaä¸­é…ç½®çš„æ‰€æœ‰æ•°æ®æº
- è¿”å›æ•°æ®æºçš„åŸºæœ¬ä¿¡æ¯ï¼ˆIDã€åç§°ã€ç±»å‹ã€URLç­‰ï¼‰
- ç”¨äºç¡®è®¤Prometheusæ•°æ®æºçš„å¯ç”¨æ€§

#### ä½¿ç”¨åœºæ™¯
- ç³»ç»Ÿåˆ†æå‰çš„æ•°æ®æºæ£€æŸ¥
- ç¡®è®¤ç›‘æ§æ•°æ®çš„æ¥æº
- å¤šæ•°æ®æºç¯å¢ƒçš„ç®¡ç†

#### è¿”å›ä¿¡æ¯
```json
{
  "id": 1,
  "name": "Prometheus",
  "type": "prometheus",
  "url": "http://prometheus:9090",
  "access": "proxy",
  "isDefault": true
}
```

### 2. grafana/query_prometheus
æ‰§è¡ŒPrometheusæŸ¥è¯¢

#### åŠŸèƒ½æè¿°
- æ‰§è¡ŒPromQLæŸ¥è¯¢è¯­å¥
- æ”¯æŒæ—¶é—´èŒƒå›´æŸ¥è¯¢
- è¿”å›ç»“æ„åŒ–çš„ç›‘æ§æ•°æ®

#### å‚æ•°è¯´æ˜
- `query`: PromQLæŸ¥è¯¢è¯­å¥
- `start`: æŸ¥è¯¢å¼€å§‹æ—¶é—´ï¼ˆå¯é€‰ï¼‰
- `end`: æŸ¥è¯¢ç»“æŸæ—¶é—´ï¼ˆå¯é€‰ï¼‰
- `step`: æŸ¥è¯¢æ­¥é•¿ï¼ˆå¯é€‰ï¼‰

#### å¸¸ç”¨æŸ¥è¯¢ç¤ºä¾‹

##### CPUä½¿ç”¨ç‡æŸ¥è¯¢
```promql
# æ•´ä½“CPUä½¿ç”¨ç‡
100 - (avg(irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100)

# æŒ‰å®ä¾‹åˆ†ç»„çš„CPUä½¿ç”¨ç‡
100 - (avg by (instance)(irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100)
```

##### å†…å­˜ä½¿ç”¨ç‡æŸ¥è¯¢
```promql
# å†…å­˜ä½¿ç”¨ç‡
(1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100

# å†…å­˜ä½¿ç”¨é‡ï¼ˆGBï¼‰
(node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / 1024 / 1024 / 1024
```

##### ç£ç›˜ä½¿ç”¨ç‡æŸ¥è¯¢
```promql
# ç£ç›˜ä½¿ç”¨ç‡
(1 - (node_filesystem_avail_bytes{fstype!="tmpfs"} / node_filesystem_size_bytes{fstype!="tmpfs"})) * 100

# ç£ç›˜å¯ç”¨ç©ºé—´ï¼ˆGBï¼‰
node_filesystem_avail_bytes{fstype!="tmpfs"} / 1024 / 1024 / 1024
```

##### ç½‘ç»œæµé‡æŸ¥è¯¢
```promql
# ç½‘ç»œæ¥æ”¶é€Ÿç‡ï¼ˆbpsï¼‰
irate(node_network_receive_bytes_total{device!="lo"}[5m]) * 8

# ç½‘ç»œå‘é€é€Ÿç‡ï¼ˆbpsï¼‰
irate(node_network_transmit_bytes_total{device!="lo"}[5m]) * 8
```

## è‡ªåŠ¨åŒ–åˆ†ææµç¨‹

### æ ‡å‡†ç›‘æ§åˆ†ææµç¨‹

1. **æ•°æ®æºæ£€æŸ¥**
   ```
   grafana/list_datasources
   ```
   - ç¡®è®¤Prometheusæ•°æ®æºå¯ç”¨
   - è·å–æ•°æ®æºé…ç½®ä¿¡æ¯

2. **CPUåˆ†æ**
   ```
   grafana/query_prometheus
   query: 100 - (avg(irate(node_cpu_seconds_total{mode="idle"}[1h])) * 100)
   ```
   - æŸ¥è¯¢è¿‡å»1å°æ—¶çš„CPUä½¿ç”¨ç‡
   - åˆ†æCPUè´Ÿè½½è¶‹åŠ¿

3. **å†…å­˜åˆ†æ**
   ```
   grafana/query_prometheus
   query: (1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100
   ```
   - æŸ¥è¯¢å½“å‰å†…å­˜ä½¿ç”¨ç‡
   - è¯„ä¼°å†…å­˜å‹åŠ›çŠ¶å†µ

4. **ç£ç›˜åˆ†æ**
   ```
   grafana/query_prometheus
   query: (1 - (node_filesystem_avail_bytes{fstype!="tmpfs"} / node_filesystem_size_bytes{fstype!="tmpfs"})) * 100
   ```
   - æŸ¥è¯¢ç£ç›˜ä½¿ç”¨æƒ…å†µ
   - è¯†åˆ«å­˜å‚¨ç©ºé—´é£é™©

5. **ç½‘ç»œåˆ†æ**
   ```
   grafana/query_prometheus
   query: irate(node_network_receive_bytes_total{device!="lo"}[1h]) * 8
   ```
   - æŸ¥è¯¢ç½‘ç»œæµé‡çŠ¶å†µ
   - åˆ†æç½‘ç»œæ€§èƒ½æŒ‡æ ‡

### æ·±åº¦åˆ†ææµç¨‹

#### æ€§èƒ½ç“¶é¢ˆåˆ†æ
1. **è¯†åˆ«é«˜è´Ÿè½½æ—¶æ®µ**
   ```promql
   # æŸ¥è¯¢CPUå³°å€¼æ—¶é—´
   max_over_time((100 - (avg(irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100))[24h:1h])
   ```

2. **åˆ†æèµ„æºå…³è”æ€§**
   ```promql
   # CPUå’Œå†…å­˜å…³è”åˆ†æ
   (
     (100 - (avg(irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100)) +
     ((1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100)
   ) / 2
   ```

3. **è¶‹åŠ¿é¢„æµ‹**
   ```promql
   # ç£ç›˜ä½¿ç”¨å¢é•¿è¶‹åŠ¿
   predict_linear(node_filesystem_avail_bytes{fstype!="tmpfs"}[24h], 7*24*3600)
   ```

## æ•°æ®è§£é‡Šå’Œåˆ†ææ ‡å‡†

### CPUæ•°æ®è§£é‡Š
- **æ•°å€¼èŒƒå›´**: 0-100%
- **æ­£å¸¸èŒƒå›´**: 0-70%
- **è­¦å‘ŠèŒƒå›´**: 70-90%
- **å±é™©èŒƒå›´**: 90-100%

### å†…å­˜æ•°æ®è§£é‡Š
- **æ•°å€¼èŒƒå›´**: 0-100%
- **æ­£å¸¸èŒƒå›´**: 0-80%
- **è­¦å‘ŠèŒƒå›´**: 80-95%
- **å±é™©èŒƒå›´**: 95-100%

### ç£ç›˜æ•°æ®è§£é‡Š
- **æ•°å€¼èŒƒå›´**: 0-100%
- **æ­£å¸¸èŒƒå›´**: 0-85%
- **è­¦å‘ŠèŒƒå›´**: 85-95%
- **å±é™©èŒƒå›´**: 95-100%

### ç½‘ç»œæ•°æ®è§£é‡Š
- **å•ä½**: bps (bits per second)
- **æ­£å¸¸èŒƒå›´**: æ ¹æ®ç½‘ç»œå¸¦å®½ç¡®å®š
- **å¼‚å¸¸æŒ‡æ ‡**: çªç„¶çš„æµé‡å³°å€¼æˆ–æŒç»­çš„é«˜æµé‡

## æŠ¥å‘Šç”Ÿæˆæ¨¡æ¿

### ç³»ç»Ÿå¥åº·æŠ¥å‘Šæ¨¡æ¿
```markdown
## ç³»ç»Ÿè¿è¡ŒçŠ¶æ€åˆ†ææŠ¥å‘Š

### ğŸ“Š ç›‘æ§æ•°æ®æ¦‚è§ˆ
- **ç›‘æ§æ—¶é—´èŒƒå›´**: {time_range}
- **æ•°æ®æº**: {datasource_info}
- **åˆ†ææ—¶é—´**: {analysis_time}

### ğŸ–¥ï¸ CPU ä½¿ç”¨æƒ…å†µ
- **å¹³å‡ä½¿ç”¨ç‡**: {cpu_avg}%
- **å³°å€¼ä½¿ç”¨ç‡**: {cpu_max}%
- **çŠ¶æ€è¯„ä¼°**: {cpu_status}
- **è¶‹åŠ¿åˆ†æ**: {cpu_trend}

### ğŸ’¾ å†…å­˜ä½¿ç”¨æƒ…å†µ
- **å½“å‰ä½¿ç”¨ç‡**: {memory_usage}%
- **å¯ç”¨å†…å­˜**: {memory_available}GB
- **çŠ¶æ€è¯„ä¼°**: {memory_status}
- **ä½¿ç”¨è¶‹åŠ¿**: {memory_trend}

### ğŸ’¿ ç£ç›˜ä½¿ç”¨æƒ…å†µ
- **ä½¿ç”¨ç‡**: {disk_usage}%
- **å¯ç”¨ç©ºé—´**: {disk_available}GB
- **çŠ¶æ€è¯„ä¼°**: {disk_status}
- **ç©ºé—´é¢„è­¦**: {disk_warning}

### ğŸŒ ç½‘ç»œæµé‡æƒ…å†µ
- **æ¥æ”¶é€Ÿç‡**: {network_rx} bps
- **å‘é€é€Ÿç‡**: {network_tx} bps
- **çŠ¶æ€è¯„ä¼°**: {network_status}
- **æµé‡æ¨¡å¼**: {network_pattern}

### ğŸ“ˆ ç»¼åˆè¯„ä¼°
- **ç³»ç»Ÿå¥åº·åº¦**: {overall_health}
- **å…³é”®å‘ç°**: {key_findings}
- **ä¼˜åŒ–å»ºè®®**: {recommendations}
- **å‘Šè­¦å»ºè®®**: {alert_suggestions}
```

## é”™è¯¯å¤„ç†å’Œæ•…éšœæ’æŸ¥

### å¸¸è§é”™è¯¯

1. **æ•°æ®æºè¿æ¥å¤±è´¥**
   - æ£€æŸ¥PrometheusæœåŠ¡çŠ¶æ€
   - éªŒè¯ç½‘ç»œè¿æ¥
   - ç¡®è®¤è®¤è¯é…ç½®

2. **æŸ¥è¯¢è¯­æ³•é”™è¯¯**
   - éªŒè¯PromQLè¯­æ³•
   - æ£€æŸ¥æŒ‡æ ‡åç§°æ‹¼å†™
   - ç¡®è®¤æ ‡ç­¾é€‰æ‹©å™¨

3. **æ•°æ®ç¼ºå¤±**
   - æ£€æŸ¥æ—¶é—´èŒƒå›´è®¾ç½®
   - éªŒè¯æŒ‡æ ‡é‡‡é›†çŠ¶æ€
   - ç¡®è®¤æ•°æ®ä¿ç•™ç­–ç•¥

### æ•…éšœæ’æŸ¥æ­¥éª¤

1. **éªŒè¯æ•°æ®æº**
   ```
   grafana/list_datasources
   ```

2. **æµ‹è¯•åŸºç¡€æŸ¥è¯¢**
   ```
   grafana/query_prometheus
   query: up
   ```

3. **æ£€æŸ¥æŒ‡æ ‡å¯ç”¨æ€§**
   ```
   grafana/query_prometheus
   query: {__name__=~"node_.*"}
   ```

4. **éªŒè¯æ—¶é—´èŒƒå›´**
   ```
   grafana/query_prometheus
   query: node_cpu_seconds_total
   start: now-1h
   end: now
   ```

## æœ€ä½³å®è·µ

1. **æŸ¥è¯¢ä¼˜åŒ–**
   - ä½¿ç”¨é€‚å½“çš„æ—¶é—´èŒƒå›´
   - é¿å…è¿‡äºå¤æ‚çš„æŸ¥è¯¢
   - åˆç†ä½¿ç”¨èšåˆå‡½æ•°

2. **æ•°æ®è§£é‡Š**
   - ç»“åˆä¸šåŠ¡åœºæ™¯åˆ†æ
   - è€ƒè™‘å†å²åŸºçº¿å¯¹æ¯”
   - å…³æ³¨è¶‹åŠ¿è€Œéç¬æ—¶å€¼

3. **æŠ¥å‘Šç”Ÿæˆ**
   - æä¾›æ¸…æ™°çš„çŠ¶æ€è¯„ä¼°
   - åŒ…å«å…·ä½“çš„æ•°å€¼ä¿¡æ¯
   - ç»™å‡ºå¯æ“ä½œçš„å»ºè®®

4. **è‡ªåŠ¨åŒ–æµç¨‹**
   - æ ‡å‡†åŒ–æŸ¥è¯¢æµç¨‹
   - å»ºç«‹åˆ†ææ¨¡æ¿
   - å®ç°æ™ºèƒ½å‘Šè­¦åˆ¤æ–­